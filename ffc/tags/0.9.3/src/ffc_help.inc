;-------------------------------------------------------------
; prototypes
;-------------------------------------------------------------

HelpDlgProc			PROTO :HWND,:UINT,:WPARAM,:LPARAM
SwitchHelpContext	PROTO

;-------------------------------------------------------------
; resources
;-------------------------------------------------------------

IDD_HELPDIALOG		equ 2000
IDC_HELPTEXT		equ 2001
IDC_HELPEXIT		equ 2002
IDC_SWITCH			equ 2003

;-------------------------------------------------------------
; defines
;-------------------------------------------------------------

;-------------------------------------------------------------
; vars
;-------------------------------------------------------------

.data

	; titles text
	;~~~~~~~~~~~~
sShowChangesLog		db "ChangesLog",0
sShowHelp			db "Справка",0

	; help text
	;~~~~~~~~~~
;sHelpTitle			db "Справка",0
sHelp				db "В режиме работы программа ждет поступления в порт данных. Каждый раз, получая данные, она "
					db "ищет среди них комбинации таких байтов:",13,10
					db "0x10FF (если это самое начало данных) или 0x??10FF, где байт 0x?? не равен 0x10. "
					db "Байт 0xFF может определяться пользователем в поле 'ID пакета'. ",13,10
					db "Затем читает следующие после 0x10FF байты вплоть до комбинации 0x1003 и отображает их в поле 'HEX'. "
					db "За одну такую итерацию параллельно происходит вычисление и отображение другой информации, что описано далее. "
					db "Так постоянно выводятся все пакеты 0xFF, принятые и распознанные программой. ",13,10,13,10
					
					db "При чтении получаемой информации учитывается, что два байта подряд 0x1010 означают один "
					db "байт 0x10.",13,10,13,10,13,10
					
					
					db "'BIN'. Есть возможность выводить отдельные байты в двоичном коде. Для этого нужно в поле ввода "
					db "'Номера байтов' через запятую ввести номера, первым считается тот байт, который "
					db "отображается первым в поле 'HEX'. Максимальный номер байта - 64. В каком порядке "
					db "были заданы номера, в таком же будут выводиться соответствующие байты.",13,10,13,10,13,10
					
					
					db "'DEC'. Здесь выводятся десятичные значения V1,V2,V3,t. Из данных каждого пакета 0x10FF выделяются слова: w1 (2-ой и 3-ий байты), w2 (4-ый и 5-ый), w3 (6-ой и 7-ой), w4 (8-ой и 9-ый), "
					db "где меньший по номеру байт считается старшим в слове. Вольты V1,V2,V3 считаются по такой формуле:",13,10
					db "     VX = wX * 0.000305176",13,10
					db "а температура:",13,10
					db "     t = w4 * 0.03052 - 273. ",13,10,13,10,13,10
					
					
					db "'DEG'. В основном поле этого блока выводятся значения углов F1 и F2, "
					db "которые имеют следующий формат отображения:",13,10
					db "     Fx = sDDD.MM.mm",13,10
					db "Где:",13,10
					db "     x - номер (1/2);",13,10
					db "     s - знак (+/-), положительный знак не отображается;",13,10
					db "     DDD - градусы (целое десятичное);",13,10
					db "     MM.mm - минуты (десятичная дробь).",13,10
					db "Углы считаются на основе введенных табличных данных (десятичные дроби):",13,10
					db "     g - ускорение свободного падения [м/с^2]",13,10
					db "     U11 - число вольт датчика1 при 0 градусов;",13,10
					db "     U21 - число вольт датчика2 при 0 градусов;",13,10
					db "     U12 - число вольт датчика1 при 90 градусов;",13,10
					db "     U22 - число вольт датчика2 при 90 градусов;",13,10
					db "     U13 - число вольт датчика1 при 180 градусов;",13,10
					db "     U23 - число вольт датчика2 при 180 градусов;",13,10
					db "     U14 - число вольт датчика1 при 270 градусов;",13,10
					db "     U24 - число вольт датчика2 при 270 градусов.",13,10
					db "При любом изменении этих данных автоматически просчитываются константы по формулам:",13,10
					db "     U10 = (U11 + U13) / 2;",13,10
					db "     U20 = (U22 + U24) / 2;",13,10
					db "     k1 = (U12 - U14) / (2 * g);",13,10
					db "     k2 = (U21 - U23) / (2 * g);",13,10
					db "     Alpha1 = (U11 - U13) / (2 * k1 * g);",13,10
					db "     Alpha2 = (U22 - U24) / (2 * k2 * g).",13,10
					db "Именно на основе этих констант вычисляютя углы по формулам:",13,10
					db "     F1 = arcsin( (V1 - U10) / (k1 * g) - Alpha1 ) * 180 / pi;",13,10
					db "     F2 = arccos( (V3 - U20) / (k2 * g) - Alpha2 ) * 180 / pi.",13,10
					db "Где V1 и V3 описывались выше.",13,10
					db "Табличные значения можно менять на ходу во время работы программы, "
					db "тогда последующие углы будут вычисляться на основе новых данных.",13,10,13,10
					
					db "Если произойдет такая ситуация, что значения аргументов функций arcsin/arccos в формулах F1/F2 "
					db "будут выходить за рамки допустимых (-1 <= x <= 1), то автоматически будут установлены такие значения аргументов:",13,10
					db "     x = 1, если x > 1;",13,10
					db "     x = -1, если x < -1.",13,10
					db "Окончательное вычисление формулы происходит на основе новых значений.",13,10
					db "Программа сигнализирует о такой ситуации дописыванием в поле 'DEG' после значений углов текста ' ERR'. "
					db "В таком же виде поле 'DEG' попадает в лог-файл, если последний используется (см. далее).",13,10,13,10,13,10
					
					
					db "'Запись в лог-файл'. Если эта опция включена, то ведется запись "
					db "в выбранный лог-файл построчно всех данных (кроме BIN) в том же виде, в котором они отображаются, "
					db "причем в таком порядке:",13,10
					db "     HEX DEC DEG [комментарий]",13,10
					db "Если включена опция 'Перезапись файла', то при каждом включении режима работы (кнопка 'Старт') "
					db "лог-файл будет очищаться и заполнятся с нуля, иначе вся новая лог-информация будет дописываться "
					db "в конец уже существующего файла.",13,10
					db "При выборе опции 'Стандартный лог-файл' путь и имя файла вводить нет потребности - "
					db "это будет сделано автоматически: имя файла будет - 'ffc.log' и он будет находится в той же директории, "
					db "где и сама программа (ffc.exe). В противном случае можно задать путь/имя вручную или выбрать (кнопка '...').",13,10,13,10
					
					db "Справа от кнопки 'старт' имеется поле ввода для заметок, которые можно внести в лог-файл "
					db "с помощью кнопки 'V'. Заметка/ремарка/комментарий заносится в конец текущей строки лог-файла (см. выше).",13,10,13,10,13,10
					
					
					db "Статус 'Всего' отображает общее количество принятых с порта байт и общее число пакетов "
					db "0x10FF, которые были найдены и прочитаны.",13,10,13,10,13,10
					
					
					db "Окно программы можно растянуть по ширине, чтобы увидеть больше данных."
					
					db 0


	; ChangesLog text
	;~~~~~~~~~~~~~~~~
sChangesLog			db "07.02.2006  v0.9.3",13,10
					db "    - Новая система справки",13,10
					db "    - Устранены мелкие ошибки",13,10
					db "    - Всплывающие подсказки :)",13,10,13,10,13,10
					db "06.02.2006  v0.9.2",13,10
					db "    - Поле 'DEG'. Блок отображения, настройки и вычисления углов",13,10
					db "    - Автоматический подсчет второстепенных коэффициентов",13,10
					db "    - Индикация математической ошибки - ' ERR'",13,10
					db "    - В лог-файл дописываются данные DEG: углы F1 и F2",13,10,13,10,13,10
					db "06.12.2005  v0.9.1",13,10
					db "    - Возможность добавлять комментарии в лог-файл в режиме работы",13,10,13,10,13,10
					db "29.11.2005  v0.9",13,10
					db "    - Отдельный вывод температуры убран",13,10
					db "    - Поле 'DEC'. Отображение десятичных значений V1,V2,V3 и температуры t.",13,10
					db "    - Вместо температуры в лог-файл заносится весь комплекс значений: V1,V2,V3,t",13,10,13,10,13,10
					db "18.11.2005  v0.8",13,10
					db "    - Исправлен баг с конвертацией температуры",13,10
					db "    - Добавление к лог-файлу вывода температуры",13,10,13,10,13,10
					db "09.11.2005  v0.7",13,10
					db "    - Отдельный вывод температуры",13,10,13,10,13,10
					db "02.11.2005  v0.6",13,10
					db "    - Склеивание пакетов при их обрыве между блоками принимаемых данных",13,10,13,10,13,10
					db "02.11.2005  v0.5",13,10
					db "    - Отлавливаются все пакеты в текущем принятом блоке данных",13,10
					db "    - Поле 'BIN'. Отображение отдельных байтов в двоичном коде",13,10
					db "    - Статус общего количества принятых байтов и пакетов",13,10
					db "    - Статус размера лог-файла",13,10
					db "    - Возможность задавать вручную путь/имя лог-файла",13,10
					db "    - Изменяемая ширина окна для большего обзора данных",13,10,13,10,13,10
					db "01.11.2005  v0.4",13,10
					db "    - Возможность записывать лог-файлы",13,10
					db "    - Опции 'Стандартный лог-файл' и 'Перезапись файла'",13,10,13,10,13,10
					db "01.11.2005  v0.3",13,10
					db "    - Исправлены мелкие ошибки",13,10
					db "    - Данные выводятся моноширинным шрифтом",13,10,13,10,13,10
					db "31.10.2005  v0.2",13,10
					db "    - Полная настройка COM-порта (номер, скорость, четность, стоп-биты)",13,10
					db "    - Возможность выбора идентификатора пакета 0xFF",13,10,13,10,13,10
					db "30.10.2005  v0.1",13,10
					db "    - Старт проекта",13,10
					db "    - Возможность выбора COM-порта и его скорости",13,10
					db "    - Выводится минимум HEX-данных"
					db 0


;-------------------------------------------------------------
; alloc memory
;-------------------------------------------------------------

.data?

hdlg2				dd ?

HelpMode			db ?		; = 0/1 -> Help/ChangesLog